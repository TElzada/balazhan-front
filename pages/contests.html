<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../images/favicon.png">
    <title>–ö–æ–Ω–∫—É—Ä—Å—ã | –ö—ã—è–ª–≥–∞ –ö–∞–¥–∞–º</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles/style.css">
</head>
<body>
<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<header class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand" href="../index.html">
            <img src="../images/logo.png" alt="–ö—ã—è–ª–≥–∞ –ö–∞–¥–∞–º" height="40">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link active" href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="nav-item"><a class="nav-link" href="news.html">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                <li class="nav-item"><a class="nav-link" href="contests.html">–ö–æ–Ω–∫—É—Ä—Å—ã</a></li>
                <li class="nav-item"><a class="nav-link" href="aboutus.html">–û –Ω–∞—Å</a></li>
            </ul>
            <button class="theme-toggle" id="themeToggle">üåô</button>
        </div>
    </div>
</header>

<main class="container my-4">
    <h1 class="mb-3">–ö–æ–Ω–∫—É—Ä—Å—ã</h1>

    <div class="d-flex flex-wrap gap-3 align-items-center mb-3">
        <div class="btn-group" role="tablist" aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏">
            <button class="btn btn-outline-secondary active tab" data-cat="all" type="button">–í—Å–µ</button>
            <button class="btn btn-outline-secondary tab" data-cat="teacher" type="button">–î–ª—è –ø–µ–¥–∞–≥–æ–≥–æ–≤</button>
            <button class="btn btn-outline-secondary tab" data-cat="kid" type="button">–î–ª—è –¥–µ—Ç–µ–π</button>
        </div>

        <div class="ms-auto">
            <input id="q" class="form-control" style="min-width:220px" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">
        </div>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <div id="contestsGrid" class="row g-4" aria-live="polite"></div>

    <div class="text-center mt-4">
        <button id="loadMore" class="btn btn-outline-primary">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë</button>
    </div>
</main>

<!-- –ú–æ–¥–∞–ª–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
<div id="modalsContainer"></div>

<footer class="footer text-center py-4">
    <img src="../images/unitednations.png" alt="–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ" height="80">
    <div class="container mt-3">
        <p>–≥. –ë–∏—à–∫–µ–∫, —É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 53<br>
            –¢–µ–ª: +996 312 383260, +996 312 486475<br>
            e-mail: <a href="mailto:kyialgakadam@gmail.com">kyialgakadam@gmail.com</a></p>
        <p class="text-muted small mt-3">¬© 2013‚Äì2025 Balajan | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /* contests page renderer (uses pages/data/contests.json relative to this file) */
    (() => {
        const DATA_URL = 'data/contests.json';
        const PAGE_SIZE = 6;

        let allContests = [];
        let filtered = [];
        let visibleCount = PAGE_SIZE;

        const grid = document.getElementById('contestsGrid');
        const modalsContainer = document.getElementById('modalsContainer');
        const tabs = document.querySelectorAll('.tab');
        const qInput = document.getElementById('q');
        const loadMoreBtn = document.getElementById('loadMore');

        async function loadData() {
            try {
                const res = await fetch(DATA_URL);
                if (!res.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ' + DATA_URL);
                allContests = await res.json();
                applyFilters();
            } catch (e) {
                grid.innerHTML = '<p class="text-danger">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.</p>';
                console.error(e);
            }
        }

        function isActive(item) {
            if (!item.startDate && !item.endDate) return true;
            const now = new Date();
            const start = item.startDate ? new Date(item.startDate) : null;
            const end = item.endDate ? new Date(item.endDate) : null;
            return (!start || now >= start) && (!end || now <= end);
        }

        function applyFilters() {
            const activeTab = document.querySelector('.tab.active').dataset.cat;
            const q = qInput.value.trim().toLowerCase();

            filtered = allContests.filter(item => {
                if (activeTab !== 'all' && item.category !== activeTab && item.category !== 'both') return false;
                if (q) {
                    const hay = (item.title + ' ' + (item.excerpt||'') + ' ' + (item.content||'')).toLowerCase();
                    if (!hay.includes(q)) return false;
                }
                return true;
            });

            // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É) –µ—Å–ª–∏ –µ—Å—Ç—å startDate
            filtered.sort((a,b) => {
                const da = a.startDate ? new Date(a.startDate) : new Date(0);
                const db = b.startDate ? new Date(b.startDate) : new Date(0);
                return db - da;
            });

            visibleCount = PAGE_SIZE;
            render();
        }

        function render() {
            grid.innerHTML = '';
            modalsContainer.innerHTML = '';
            const slice = filtered.slice(0, visibleCount);
            if (slice.length === 0) {
                grid.innerHTML = '<p>–ù–µ—Ç –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º.</p>';
                loadMoreBtn.style.display = 'none';
                return;
            }

            slice.forEach(it => {
                const col = document.createElement('div');
                col.className = 'col-12 col-md-6 col-lg-4';

                const img = it.imageUrl ? `<img src="${escape(it.imageUrl)}" class="card-img-top" alt="${escape(it.title)}" style="height:160px; object-fit:cover; border-radius:8px 8px 0 0;">` : '';
                const startDateText = it.startDate ? `–° ${new Date(it.startDate).toLocaleDateString()}` : '';

                col.innerHTML = `
        <div class="card h-100 shadow-sm">
          ${img}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">${escape(it.title)}</h5>
            <div class="mb-2 text-muted small">${startDateText}</div>
            <p class="card-text flex-grow-1">${escape(it.excerpt || '')}</p>
          </div>
          <div class="card-footer text-center bg-white">
            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modal-${escapeId(it.slug)}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <a class="btn btn-link" href="contest.html?slug=${encodeURIComponent(it.slug)}">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É</a>
          </div>
        </div>`;

                grid.appendChild(col);

                // modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = `modal-${escapeId(it.slug)}`;
                modal.tabIndex = -1;
                modal.setAttribute('aria-hidden', 'true');

                const stagesHtml = (it.stages || []).map(s => `<li><strong>${escape(s.title)}</strong> ‚Äî ${escape(s.date)}: ${escape(s.description)}</li>`).join('');
                modal.innerHTML = `
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">${escape(it.title)}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              ${ it.imageUrl ? `<img src="${escape(it.imageUrl)}" alt="${escape(it.title)}" class="img-fluid mb-3">` : '' }
              <p class="mb-1"><strong>–°—Ä–æ–∫–∏:</strong> ${escape(it.startDate||'')} ${it.endDate ? '‚Äî ' + escape(it.endDate) : ''}</p>
              <p><strong>–ö—Ä–∞—Ç–∫–æ:</strong> ${escape(it.excerpt||'')}</p>
              <hr>
              <div><strong>–≠—Ç–∞–ø—ã:</strong>
                <ul>${stagesHtml}</ul>
              </div>
              <hr>
              <div class="full-content">${it.content || ''}</div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
              <a class="btn btn-primary" href="contest.html?slug=${encodeURIComponent(it.slug)}">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–æ–ª–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</a>
            </div>
          </div>
        </div>`;

                modalsContainer.appendChild(modal);
            });

            loadMoreBtn.style.display = visibleCount < filtered.length ? 'inline-block' : 'none';
        }

        function escape(s) {
            if (!s) return '';
            return String(s)
                .replaceAll('&','&amp;')
                .replaceAll('<','&lt;')
                .replaceAll('>','&gt;')
                .replaceAll('"','&quot;');
        }
        function escapeHtml(s){ return escape(s); }
        function escapeId(s){ return String(s).replace(/[^a-zA-Z0-9-_]/g,'-'); }

        // listeners
        tabs.forEach(t => t.addEventListener('click', () => {
            tabs.forEach(x => x.classList.remove('active'));
            t.classList.add('active');
            applyFilters();
        }));
        qInput.addEventListener('input', () => applyFilters());
        loadMoreBtn.addEventListener('click', () => { visibleCount += PAGE_SIZE; render(); });

        // load
        loadData();
    })();
</script>

</body>
</html>
